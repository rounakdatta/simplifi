<!DOCTYPE html>
<html>
<head>
  <title>RUET ChatBot</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://notepad.pw/raw/uiuz0slx">
        <link rel="icon" type="image/png" href="img/ruet.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<style>

   .chat
   {
   
     position:fixed;
     bottom:0;
     right:0;
     margin-right: 20px;
     max-width:300px;
     z-index:999;
     box-shadow: 4px 4px 4px 4px;
     border: : 2px solid rgb(22,118,134);
   }



     #sc
     {
      background-color: rgb(22,118,134);
      padding:15px;
      color:white;
      font-size: 16px;
      width:300px;
      height: 45px;


     }

     #panel
     {
       
        background-color: white;
        display: none;
        margin:0;
        width:300px;
        height: 300px;

     }

     #div
     {
        padding:10px;
        height: 240px;
        position: relative;
        overflow-y: auto;
        
     }
  
     input[type=text] 
     {
          width: 100%;
          padding: 12px 20px;
          margin: 8px 0;
          box-sizing: border-box;
     }

     .ou
     {
        background-color:rgb(241,240,240);
        color:black;
        padding:10px; 
        left:5; 
        width:130px;
        text-align: center;
        height:auto;
        border-radius: 15px;
  
      }

      .inp
     {
        background-color:rgb(241,240,240);
        color:black;
        padding:10px; 
        left:10; 
        width:130px;
        text-align: center;
        height:auto;
        border-radius: 15px;
  
      }

      .stt
      {
         margin-top:5px;
        
      }

  

</style>


<body>


<div class="container">



<div class="row">


<div class="col-sm-5">

</div>

<div class="col-sm-7">





<div class="chat">
<a style="text-decoration:none;" href="#"><div id="sc"><center ><img style="float:left;" src="img/ruet.png" width="20px" height="20px"/><b>Chat With RUET</b></center></div></a>
<div id="panel">
  

<script>

$(document).ready(function(){

    var i=0;
    var st;

    $("#sc").click(function(){

         
          i++;

          $("#panel").slideToggle();

          if(i==1)
          {
              $('#div').html("<div class=\"ou\"> Hello Guest. Welcome To Ruet Chat</div><br>");

          }
          

           

        });



});



</script>


<script type="text/javascript">
  
  $(document).ready(function(){

     $("#st").click(function(){

           var str=$("#tt").val();
  
           $("#div").html(str);



     });

  });


</script>

<script>
//wait for page load to initialize script
$(document).ready(function(){

 window.alreadySubmit = false;

  $('#tt').keypress(function(f){

     
     if(f.which == 13 && !alreadySubmit) {
        window.alreadySubmit = true;

    //listen for form submission

    $('form').on('submit', function(e){
      //prevent form from submitting and leaving page
      e.preventDefault();
      console.log("joo");

      document.getElementById("div").innerHTML += ("<div class='inp'>" + $('form').serialize().replace("input=", "") + "</div>");

      // var xhttp = new XMLHttpRequest();
	    // if (this.readyState == 4 && this.status == 200) {
      // 	xhttp.onreadystatechange = function() {
      // 	       // Typical action to be performed when the document is ready:
      // 		   let resultOfSearch = xhttp.responseText;
      //        console.log(resultOfSearch);
      // 		   let queryReply = JSON.parse(resultOfSearch)["reply"];
      // 		   console.log(queryReply);
      // 		   if (JSON.parse(resultOfSearch)["context"] == "so") {
            
      // 			   let finalAnswer = "<ul>";
              
      // 				queryReply.forEach(element => {
      // 					finalAnswer += ("<li><a href='" + element + "'>" + element + "</a></li>");
              
      // 				});
      // 				finalAnswer += "</ul>";
      // 				//document.getElementById('messages').innerHTML += finalAnswer;
      //         $('#div').append("<div class=\"stt\""+finalAnswer+"</div>");
      //           $('#tt').val("");
            
      // 		   } else {
            
      // 			   if (JSON.parse(resultOfSearch)["context"] == "github") {
              
              
      // 				   let finalAnswer = "<ul>";
                
      // 					queryReply.forEach(element => {
      // 						finalAnswer += ("<li><a href='" + element['html_url'] + "'>" + element['html_url'] + "</a></li>");
      // 					});
      // 					finalAnswer += "</ul>";
              
      // 					//document.getElementById('messages').innerHTML += finalAnswer;
      //           $('#div').append("<div class=\"stt\""+finalAnswer+"</div>");
      //             $('#tt').val("");
              
      // 			   } else {
      // 				//document.getElementById('messages').innerHTML += queryReply;
      //         $('#div').append("<div class=\"stt\""+queryReply+"</div>");
      //           $('#tt').val("");
      // 			   }
      // 		   } 
      // 	       // return xhttp.responseText;
      // 	    }
      // 	};
      // 	xhttp.open("POST", "http://localhost:5000/process", true);
      // 	xhttp.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
      //   var payload = $('form').serialize();
      //   payload = payload.replace("input", "chatInput");
      // 	xhttp.send(payload);


        //------------------------------------------------------

      // AJAX 
      $.ajax({
            type: "POST", //type of submit
            cache: false, //important or else you might get wrong data returned to you
            url: "http://localhost:5000/process", //destination
            datatype: "html", //expected data format from process.php
            data: $('form').serialize().replace("input", "chatInput"), //target your form's data and serialize for a POST
            success: function(result) { // data is the var which holds the output of your process.php

                // locate the div with #result and fill it with returned data from process.php
               
                console.log(result);

                let resultOfSearch = result;
          		   let queryReply = JSON.parse(resultOfSearch)["reply"];
          		   console.log(queryReply);
                      
          		   if (JSON.parse(resultOfSearch)["context"] == "so") {
                
          			   let finalAnswer = "<ul>";
                  
          				queryReply.forEach(element => {
          					finalAnswer += ("<li><a href='" + element + "'>" + element + "</a></li>");
          				});
          				finalAnswer += "</ul>";
                
                  document.getElementById("div").innerHTML += ("<div class='ou'>" + finalAnswer + "</div>");

                    $('#tt').val("");

                
          		   } else {
                
          			   if (JSON.parse(resultOfSearch)["context"] == "github") {
                  
          				   let finalAnswer = "<ul>";
                    
          					queryReply.forEach(element => {
          						finalAnswer += ("<li><a href='" + element['html_url'] + "'>" + element['html_url'] + "</a></li>");
          					});
          					finalAnswer += "</ul>";
                  
                    document.getElementById("div").innerHTML += ("<div class='ou'>" + finalAnswer + "</div>");

                    $('#tt').val("");

                  
          			   } else {
                    document.getElementById("div").innerHTML += ("<div class='ou'>" + queryReply + "</div>");

                    $('#tt').val("");

          			   }
          		   } 


                // $('#div').append("<div class=\"stt\""+result+"</div>");

                // $('#tt').val("");

            }
        });
    });
  }
    
       
  
});

   
});

               
</script>

<div id='div' name="output" >
  
  <div id="div1"></div>


</div>
<br>

<!--<script>
"use strict";
function submitForm(oFormElement)
{
  var xhr = new XMLHttpRequest();
  var display=document.getElementById('div');
  xhr.onload = function(){ display.innerHTML=xhr.responseText; }
  xhr.open (oFormElement.method, oFormElement.action, true);
  xhr.send (new FormData (oFormElement));
  return false;
}
</script>-->
<!--<label for="out">Output</label>
<textarea id='div' class="form-control" name="output" rows="10" cols="50"></textarea><br><br>-->

<div class="form-group">
<form action="process.php" id="form" name="f2" method="POST" >

<input type="textarea" id="tt" name="input" placeholder="Type Your Message" style="position:absolute; bottom:0; height:30px; width:100%; height:50px;" required />


</form>


</div>




</div></div>

</div>

</div>

</div>

</body>
</html>
